import com.*

/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */

task downloadMinecraftJars(type: Download){
    src 'https://launcher.mojang.com/v1/objects/bb2b6b1aefcd70dfd1892149ac3a215f6c636b07/server.jar'
    dest buildDir
    overwrite false
}

task buildMinecraft(type: Deb) {
    dependsOn downloadMinecraftJars
    packageName 'minecraft'
    version '1.15.2'
    release '1'
    arch 'all'
    os 'Linux'
    requires('openjdk-11-jdk-headless')
    preInstall file('scripts/preInstall.sh')
    postInstall file('scripts/postInstall.sh')
    from('opt/minecraft') {
        into '/opt/minecraft'
        user 'minecraft'
        permissionGroup 'minecraft'
        fileMode 0644
    }
    from(buildDir) {
        into '/opt/minecraft'
        include 'server.jar'
        user 'minecraft'
        permissionGroup 'minecraft'
        fileMode 0644
    }
    from('etc/systemd') {
        into '/etc/systemd/system'
        user'root'
        permissionGroup 'root'
        fileMode 0644
    }
}

build {
    dependsOn buildMinecraft
}
